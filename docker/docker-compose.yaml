name: epic-awesome-gamer

services:
  epic-awesome-gamer:
    image: ghcr.io/10000ge10000/epic-awesome-gamer:latest
    restart: always
    container_name: epic-awesome-gamer
    
    environment:
      - TZ=Asia/Shanghai

      # ----------------------------------------
      # 核心账号配置
      # ----------------------------------------
      - EPIC_EMAIL=你的邮箱@example.com
      - EPIC_PASSWORD=你的密码
      - GEMINI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxx

      # ----------------------------------------
      # LLM 配置（严禁代码私自改写 base_url；按 LLM_MODE 选择协议）
      # ----------------------------------------
      # 三种模式：openai / gemini_native / gemini_openai
      - LLM_MODE=gemini_native
      # base_url 由你决定是否包含 /v1、/proxy 等前缀；代码不会自动补 /gemini、/v1
      # - openai: POST {base_url}/chat/completions
      # - gemini_native: POST {base_url}/v1beta/models/{model}:generateContent（若 base_url 已含 /v1beta 则不重复添加）
      # - gemini_openai: POST {base_url}/v1beta/openai/chat/completions（若 base_url 已含 /v1beta/openai 则不重复添加）
      - LLM_BASE_URL=https://generativelanguage.googleapis.com

      # 兼容旧变量（可选）：未设置 LLM_BASE_URL 时会回退使用 GEMINI_BASE_URL
      - GEMINI_BASE_URL=https://generativelanguage.googleapis.com
      - GEMINI_MODEL=gemini-2.5-pro

      # ----------------------------------------
      # 运行参数
      # ----------------------------------------
      - ENABLE_APSCHEDULER=true
      
      - DISABLE_BEZIER_TRAJECTORY=true
      - EXECUTION_TIMEOUT=120
      - RESPONSE_TIMEOUT=30
      - RETRY_ON_FAILURE=true
      - WAIT_FOR_CHALLENGE_VIEW_TO_RENDER_MS=1500
      - CONSTRAINT_RESPONSE_SCHEMA=true
      # 关键：默认所有验证码子任务统一使用 GEMINI_MODEL（如需分别设置，可自行添加同名变量）
      - IMAGE_CLASSIFIER_THINKING_BUDGET=970
      - SPATIAL_POINT_THINKING_BUDGET=1387
      - SPATIAL_PATH_THINKING_BUDGET=1652

    volumes:
      - "./volumes/:/app/app/volumes/"

    entrypoint: [ "/usr/bin/tini", "--" ]
    command: xvfb-run --auto-servernum --server-num=1 --server-args='-screen 0, 1920x1080x24' uv run app/deploy.py

    mem_limit: 4g
    shm_size: '2gb'
